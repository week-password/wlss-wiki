[wiki](../../README.md) / [backend](index.md) /


# Задачи. Бэклог бэклога

Здесь будут просто заметки о том, что надо бы не забыть сделать. Сюда можно писать вещи, когда просто лень или есть определенные причины не создавать тикет.

***

- Добавить в README.md инструкцию по работе с зависимостями (poetry add ...) (poetry lock --no-update) (poetry lock --check) (устанавливать типы для майпая как поэтри зависимости вместо `mypy --install-types`) и всякие прочие штуки.

- Добавить описание проекта в репозитории проекта. Что такое вишер, что он позволяет делать и прочее. (можно сделать к моменту релиза MVP)

- Добавить команду `pip install --upgrade pip` в README.md First time setup, чтобы разработчики не получали ворнинги в консоли и работали с последней версией пипа

- заменить все относительные пути на абсолютные от рута проекта, см. [коммент](https://github.com/week-password/wisher-backend/pull/37#discussion_r1181081567)

- поправить опечатку в компоуз файлах "corrent file", и ещё множество других, например "This ugly" (нужно добавить "is"), "setup" во многих местах где должно быть "set up". И вообще внимательно посмотреть всё на предмет опечаток / ошибок

- добавить автоматизацию смены статуса тикета на "In review" при запросе ревью на пулл реквесте

- добавить поле closed_at в тикеты и автоматическое проставление этого поля при закрытии тикета, это позволит нам сделать сортировку по дате закрытия тикета на борде, чтобы последние тикеты отображались наверху а не внизу, хотя возможно стоит дождаться официального релиза этой фичи (см. [тут](https://github.com/orgs/community/discussions/8518) и [тут](https://github.com/github/roadmap/issues/659))

- добавить контекстные тикеты в коммит месседжи, например `(#40 > #21)` - пока не уверен, т.к. если мы в какой-то момент захотим автоматизировать создание коммит месседжей (см [обсуждение](https://github.com/week-password/wisher-backend/discussions/28)), то подход с контекстными тикетами может создать проблемы

- провести ресерч преимуществ и недостатков [pytest-describe](https://pypi.org/project/pytest-describe/) и [pytest-spec](https://pypi.org/project/pytest-spec/) и порефакторить тесты с использованием того или иного плагина

- придумать возможность удобной передачи списка файлов для линтинга в рафф и пайлинт, потому что каждый раз писать `pylitnt src tests` не очень удобно, а что самое главное можно в какой-то момент забыть указать папку которую необходимо проверить. Это поможет избежать ошибок типо [этой](https://github.com/week-password/wisher-backend/pull/20) **скорее всего ~~tox~~, ~~Invoke~~, bash решит эту проблему** Также это позволит убрать нам все конфигурационные файлы тулов в отдельную папку `tools/`, например `tools/flake8/config.ini`.

- рассмотреть использование make для запуска длинных docker compose команд на CI

- при настройке CD не забыть про `alembic check` (см. [доку](https://alembic.sqlalchemy.org/en/latest/autogenerate.html#running-alembic-check-to-test-for-new-upgrade-operations)). Спойлер - забыли, надо добавить

- добавить команду `poetry lock --check` в CI

- поресерчить решение проблем возникших при работе с pytest-alembic и описанных [здесь](https://github.com/week-password/wisher-backend/issues/29#issuecomment-1545976623)

- добавить возможность читать параметр конфигурации из pylintrc файла для [pylint-per-file-ignores](https://github.com/christopherpickering/pylint-per-file-ignores)

- зафиксировать версии сервисов в компоуз файлов

- отсортировать всё в компоуз файлах в алфавитном порядке

- заменить скрипт `envs/local/dev/scripts/git/iam.sh` на инструкцию в разделе "First time setup"

- рассмотреть возможность добавления [Rich](https://github.com/Textualize/rich#rich-library) для настройки [трейсбеков](https://rich.readthedocs.io/en/latest/traceback.html#) при разработке (огромные трейсы от асинхронного кода немного раздражают)

- обновить зависимости перед началом разработки функциональности MVP

- убрать разделители `***` вокруг раздела "System requirements" в README.md - кажется в них нет смысла ведь каждый заголовок и так отделен линией, а также первый разделитель в разделе "Troubleshooting", а также добавить пустую строку перед разделом "Working with migrations" и перед разделом "System requirements"

- после релиза MVP попытаться порефакторить код с помощью внедрения [DDD репозиториев](https://dddinpython.com/index.php/2022/11/09/implementing-the-repository-pattern-using-sqlalchemy/), решение принято в этом [мр](https://github.com/week-password/wisher-backend/pull/46#discussion_r1194064687)

- после релиза MVP попытаться порефакторить структуру папок в соответствии с обсуждением в [мр](https://github.com/week-password/wisher-backend/pull/46#discussion_r1193114213)

- написать checker для whitelist.txt файла, который будет репортить неиспользуемые слова

- написать плагин для флейка, который запрещал бы `else` и `elif`

- форкнуть flake8-import-order и дописать логику по сортировке импортов в TYPE_CHECKING блоке

- ~~перед началом разработки MVP функциональности и после настройки CD, сделать "Plug And Play" сборки для бэка и фронта~~ фронт сказал, что им это не нужно, на бэке скорее всего тоже пока обойдёмся

- поресерчить возможность использования более строгих типов определенных в [pydantic](https://docs.pydantic.dev/latest/usage/types/#pydantic-types)

- убрать шаг "apply alembic migrations" из раздела "Run tests" в README.md, т.к. миграции на тестовую базу накатываются автоматически (см. `tests/conftest.py::pytest_sessionstart`)

- поправить наличие/отсутствие пустых строк в файле .ruff.toml (разделы начинающиеся с квадратных скобок должны быть разделены двумя пустыми строками), параметры внутри разделов - одной. Первая опция конфигурации в каждом разделе должна быть отделена от названия раздела одной пустой строкой.

- поправить консистентность названий использующихся в команде `WORKDIR` в докерфайлах

- переименовать воркфлоу файлы в вид `<environment>-<goal>`, например: `deploy-to-test.yml` -> `test-deploy.yml`, `lint.yml` -> `ci-lint.yml` и тд

- ~~убрать копирование `pyproject.toml` перед установкой зависимостей в докерфайлах - установка зависимостей должна происходит только с использованием `poetry.lock` файла~~, pyproject.toml нужен при установке зависимостей для определения групп, в которых они находятся, т.к. лок-файл не различает группы

- добавить [poetry-plugin-sort](https://pypi.org/project/poetry-plugin-sort/) для сортировки зависимостей (Но надо найти способ, чтобы не ставить его в глобальный скоуп, в котором по дефолту находится Poetry, возможно нужно использовать pipx)

- Зафиксировать версию поэтри в pyproject.toml, чтобы не перепесивалась первая строка в локфайле (Не уверен, что это правильный способ, т.к. он фризит только версию poetry-core, и возможно это не то, что нужно)

- оптимизировать конфигурацию поэтри для деплоя (нужно просмотреть [список](https://python-poetry.org/docs/configuration/#available-settings) настроек и посмотреть какие из них лучше подходят для деплоя)

- ограничить возможность деплоя (пуш тэга) только для участников репозитория

- поресерчить возможности сокрытия апишки бэкенда для всех кроме фронта

- добавить в healthcheck эндпойнт проверку коннекшенов ко внешним сервисам типо постгреса и минио (задача вдохновлена [этим](https://microservices.io/patterns/observability/health-check-api.html))

- подумать куда можно вынести определения сваггера, чтобы не засорять файлы `routes.py` (см. [пр](https://github.com/week-password/wlss-backend/pull/75#discussion_r1236629728))

- подумать над добавлением тэга в название роутера, чтобы его было удобнее использовать, например: `APIRouter(tags="auth")` -> `AuthRouter(tags="auth")`, `APIRouter(tags="service")` -> `ServiceRouter(tags="service")`

- подумать над добавлением файла, который исключает коммиты из блейма, почитать об этом можно [тут](https://www.stefanjudis.com/today-i-learned/how-to-exclude-commits-from-git-blame/), [тут](https://git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revs-fileltfilegt) и [тут](https://docs.github.com/en/repositories/working-with-files/using-files/viewing-a-file#ignore-commits-in-the-blame-view)

- разобраться почему при использовании нашего кастомного декоратора @enum.types(), в IDE перестаёт работать автокомплит для членов этого енама
